---
/* src/components/Header.astro */
const BRAND_LINK = "/"; 
---

<header class="site-header">
  <div class="header-inner">
    
    <a href={BRAND_LINK} class="site-title">
      <img src="/logo.png" alt="Heat Shock Pineapple" class="header-logo" />
      <span class="brand-text">
        <span class="brand-main">Heat Shock</span><span class="gold"> Pineapple</span>
      </span>
    </a>

    <div class="header-controls">
      <button class="icon-btn theme-toggle" aria-label="Toggle Dark Mode" type="button">
        <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
        <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
      </button>
    </div>

  </div>
</header>

<script>
  function setupHeader() {
    const themeToggles = document.querySelectorAll('.theme-toggle');

    // HELPER: Strips old listeners cleanly (Directly from Photos Header [cite: 214])
    const replaceWithClone = (el) => {
      if (!el?.parentNode) return el;
      const clone = el.cloneNode(true);
      el.parentNode.replaceChild(clone, el);
      return clone;
    };

    // THEME TOGGLE Logic matching Photos Header [cite: 223]
    themeToggles.forEach((btn) => {
      const newBtn = replaceWithClone(btn);
      newBtn.addEventListener('click', (e) => {
        e.stopPropagation(); 
        const element = document.documentElement;
        const current = element.getAttribute("data-theme");
        const next = current === "dark" ? "light" : "dark";
        element.setAttribute("data-theme", next);
        localStorage.setItem("theme", next);
      });
    });
  }

  // Run on load & transitions matching Photos Header [cite: 224, 225]
  setupHeader();
  document.addEventListener('astro:after-swap', setupHeader);
  document.addEventListener('astro:page-load', setupHeader);
</script>

<style>
  /* === LAYOUT ARCHITECTURE (Matches Photos Header [cite: 226-230]) === */
  .site-header { 
    position: sticky; 
    top: 0; 
    z-index: 1000; 
    padding: 1.2rem 0;
  }
  
  .site-header::before {
    content: ""; 
    position: absolute; 
    inset: 0; 
    z-index: -1;
    background: #243b30; /* Jungle Green [cite: 227] */
    opacity: 0.95;
    backdrop-filter: blur(12px);
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }

  .header-inner { 
    width: 100%; 
    max-width: 1600px; /* Hub Specific Width */
    margin: 0 auto; 
    padding: 0 2rem; 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
  }
  
  /* BRANDING (Matches Photos Header [cite: 230-234]) */
  .site-title { 
    display: flex; 
    align-items: center; 
    gap: 0.75rem; 
    text-decoration: none; 
    z-index: 1002; 
  }
  
  .brand-text { 
    font-family: var(--font-serif); 
    font-weight: 600; 
    font-size: 1.3rem; 
    color: var(--text-inverse, #ffffff);
    word-spacing: -0.15em;
    letter-spacing: 0.01em; 
  }
  
  .gold { 
    font-style: normal;
    font-size: 1.02em; 
  }

  .header-logo { 
    height: 32px; 
    width: auto; 
    border-radius: 4px; 
  }

  /* CONTROLS (Matches Photos Header [cite: 234-237]) */
  .header-controls { 
    display: flex; 
    align-items: center; 
  }

  .icon-btn { 
    background: none; 
    border: none; 
    cursor: pointer; 
    padding: 5px; 
    display: flex; 
    align-items: center; 
    transition: color 0.2s;
    color: rgba(255,255,255,0.7);
  }

  .icon-btn:hover { 
    color: var(--text-inverse, #ffffff); 
  }

  /* THEME ICONS (Direct Copy of Photos Logic [cite: 240-242]) */
  /* Default (Dark Mode) -> Show Moon */
  .sun-icon { display: none; }
  .moon-icon { display: block; }

  /* Light Mode Override -> Show Sun */
  :global([data-theme="light"]) .sun-icon { display: block; }
  :global([data-theme="light"]) .moon-icon { display: none; }
</style>